default_platform(:android)

platform :android do
  desc "Deploy to Google Play (internal/alpha/beta/production)"
  lane :deploy do |options|
    track = options[:track] || "alpha"
    aab_path = options[:aab] || Dir["*.aab"].first || Dir["**/*.aab"].first

    if aab_path.nil?
      UI.user_error!("No AAB file found. Please provide path with aab: parameter")
    end

    upload_to_play_store(
      track: track,
      aab: aab_path,
      skip_upload_apk: true,
      skip_upload_metadata: false,
      skip_upload_images: false,
      skip_upload_screenshots: false
    )
  end

  desc "Upload metadata only (no binary)"
  lane :metadata do
    upload_to_play_store(
      skip_upload_apk: true,
      skip_upload_aab: true,
      skip_upload_metadata: false,
      skip_upload_images: false,
      skip_upload_screenshots: false
    )
  end

  desc "Download current metadata from Play Store"
  lane :fetch_metadata do
    download_from_play_store
  end
end
